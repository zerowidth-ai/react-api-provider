{"version":3,"file":"index.js","sources":["../../src/index.js"],"sourcesContent":["import React, { createContext, useState, useContext, useCallback } from 'react';\n\nconst ZeroWidthApiContext = createContext();\n\nconst generateId = () => `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\nexport const ZeroWidthApiProvider = ({ children, appId, endpointId, proxyUrl, debugMode }) => {\n  if (debugMode) console.log('ZeroWidthApiProvider', { appId, endpointId, proxyUrl, debugMode });\n\n  const effectiveEndpointId = endpointId || appId;\n  if (appId) {\n    console.warn('Warning: The appId prop is deprecated and will be removed in future versions. Please use endpointId instead.');\n  }\n\n  if (!effectiveEndpointId || typeof effectiveEndpointId !== 'string' || typeof proxyUrl !== 'string') {\n    throw new Error('endpointId (or appId for backward compatibility) and proxyUrl props must be provided as strings to ZeroWidthApiProvider');\n  }\n\n  const [data, setData] = useState({});\n  const [error, setError] = useState({});\n  const [loading, setLoading] = useState({});\n  const [stream, setStream] = useState({});\n\n  const process = useCallback(async (options = {}, identifier = generateId()) => {\n    setLoading(prev => ({ ...prev, [identifier]: true }));\n    setError(prev => ({ ...prev, [identifier]: null }));\n    setStream(prev => ({ ...prev, [identifier]: [] }));\n    setData(prev => ({ ...prev, [identifier]: null }));\n\n    try {\n      const url = `${proxyUrl}/process/${effectiveEndpointId}/${options.agentId}`;\n      const headers = { 'Content-Type': 'application/json' };\n\n      if (options.stream) {\n        const response = await fetch(url, {\n          method: 'POST',\n          headers,\n          body: JSON.stringify(options),\n        });\n\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const reader = response.body.getReader();\n        const decoder = new TextDecoder('utf-8');\n        let buffer = '';\n        let eventType = '';\n\n        const readStream = async () => {\n          while (true) {\n            const { done, value } = await reader.read();\n            if (done) break;\n\n            buffer += decoder.decode(value, { stream: true });\n            let lines = buffer.split('\\n');\n\n            for (let i = 0; i < lines.length - 1; i++) {\n              const line = lines[i].trim();\n              if (line.startsWith('event: ')) {\n                eventType = line.slice(7).trim();\n              } else if (line.startsWith('data: ')) {\n                const eventData = JSON.parse(line.slice(6));\n                setStream(prev => ({\n                  ...prev,\n                  [identifier]: [...(prev[identifier] || []), { eventType, data: eventData }]\n                }));\n              }\n            }\n\n            buffer = lines[lines.length - 1];\n          }\n        };\n\n        readStream().catch(err => {\n          setError(prev => ({ ...prev, [identifier]: err }));\n        });\n\n      } else {\n        const response = await fetch(url, {\n          method: 'POST',\n          headers,\n          body: JSON.stringify(options)\n        });\n        const responseData = await response.json();\n        setData(prev => ({ ...prev, [identifier]: responseData }));\n        return responseData;\n      }\n    } catch (err) {\n      setError(prev => ({ ...prev, [identifier]: err }));\n    } finally {\n      setLoading(prev => ({ ...prev, [identifier]: false }));\n    }\n  }, [proxyUrl, effectiveEndpointId]);\n\n  const getHistory = useCallback(async ({ agentId, userId, sessionId, startAfter } = {}, identifier = generateId()) => {\n    setLoading(prev => ({ ...prev, [identifier]: true }));\n    setError(prev => ({ ...prev, [identifier]: null }));\n\n    try {\n      const queryParams = new URLSearchParams(startAfter ? { startAfter } : {});\n      const response = await fetch(`${proxyUrl}/history/${effectiveEndpointId}/${agentId}/${userId}/${sessionId}?${queryParams}`);\n      const responseData = await response.json();\n      setData(prev => ({ ...prev, [identifier]: responseData }));\n    } catch (err) {\n      setError(prev => ({ ...prev, [identifier]: err }));\n    } finally {\n      setLoading(prev => ({ ...prev, [identifier]: false }));\n    }\n  }, [proxyUrl, effectiveEndpointId]);\n\n  return (\n    <ZeroWidthApiContext.Provider value={{ data, error, loading, stream, process, getHistory }}>\n      {children}\n    </ZeroWidthApiContext.Provider>\n  );\n};\n\nexport const useZeroWidthApi = () => {\n  const context = useContext(ZeroWidthApiContext);\n  if (context === undefined) {\n    throw new Error('useZeroWidthApi must be used within a ZeroWidthApiProvider');\n  }\n  return context;\n};\n"],"names":["ZeroWidthApiContext","createContext","generateId","concat","Date","now","Math","random","toString","substr","_ref","children","appId","endpointId","proxyUrl","debugMode","console","log","effectiveEndpointId","warn","Error","_useState2","_slicedToArray","useState","data","setData","_useState4","error","setError","_useState6","loading","setLoading","_useState8","stream","setStream","process","useCallback","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","options","identifier","url","headers","response","reader","decoder","buffer","eventType","readStream","_response","responseData","_args3","arguments","wrap","_context3","prev","next","length","undefined","_objectSpread","_defineProperty","agentId","fetch","method","body","JSON","stringify","sent","ok","status","getReader","TextDecoder","_ref3","_callee","_yield$reader$read","done","value","lines","_loop","i","_context2","read","abrupt","decode","split","line","eventData","_context","trim","startsWith","slice","parse","_toConsumableArray","stop","delegateYield","apply","this","err","json","t0","finish","getHistory","_callee3","_ref5","userId","sessionId","startAfter","queryParams","_args4","_context4","URLSearchParams","React","createElement","Provider","context","useContext"],"mappings":"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"}